<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SerialPortManager Data Polling</title>
    <style>
        /* 추가적인 스타일 (필요시) */
        .time-inputs {
            display: none;
        }
    </style>
</head>
<body class="light-font">
<h1>주문화면</h1>
<h1>App Version: <span id="version"></span></h1>
<div>
    <div>
        <button id="goToAdmin">Go to Admin</button>
        <button id="goToOrder">Go to Order</button>
        <button id="goToTest">Go to Test</button>
    </div>
    <fieldset>
        <h1>Menu Options</h1>

        <!-- 메뉴 선택 폼 -->
        <form id="menuForm">
            <h2>Menu ID: 1</h2>
            <!-- 메뉴명 -->
            <fieldset>
                <legend>MENU-ITEM</legend>
                <label for="menuName">메뉴명</label>
                <input type="text" id="menuName" name="menuName">
            </fieldset>
            <!-- 카테고리 -->
            <fieldset>
                <legend>Category</legend>
                <label for="category">카테고리</label>
                <select id="category" name="Category" >
                    <option value="coffee">커피</option>
                    <option value="tea">티</option>
                    <option value="ade">에이드</option>
                    <option value="other">기타음료</option>
                </select>
            </fieldset>
            <fieldset id="priceInput">
                <legend>금액</legend>
                <label for="price">금액</label>
                <input type="number" id="price" name="price" min="0">
            </fieldset>
            <!-- 컵 옵션 -->
            <fieldset>
                <legend>Cup</legend>
                <label for="cupPlastic">플라스틱컵</label>
                <input type="radio" id="cupPlastic" name="cup" value="plastic">
                <label for="cupPaper">종이컵</label>
                <input type="radio" id="cupPaper" name="cup" value="paper">
            </fieldset>

            <!-- 얼음 여부 -->
            <fieldset>
                <legend>얼음</legend>
                <label for="iceYes">Yes</label>
                <input type="radio" id="iceYes" name="iceYn" value="yes">
                <label for="iceNo">No</label>
                <input type="radio" id="iceNo" name="iceYn" value="no">
            </fieldset>

            <!-- 얼음과 물 옵션 -->
            <div id="iceInput" class="time-inputs">
                <label for="iceTime">얼음시간 :</label>
                <input type="number" id="iceTime" name="iceTime" min="0" step="0.5" placeholder="Enter ice time">
                <br>
                <label for="waterTime">물시간 :</label>
                <input type="number" id="waterTime" name="waterTime" min="0" step="0.5" placeholder="Enter water time">
            </div>

            <fieldset>
                <!-- 결과 출력 영역 -->
                <div id="selectedOptions"></div>
            </fieldset>
        </form>
        <fieldset>
            <legend>ITEM</legend>
            <div id="itemContainer">
                <button id="addItemBtn">+ 항목 추가</button>
            </div>
            <button id="saveMenuBtn">저장</button>
        </fieldset>
    </fieldset>
    <div>
        <button id="setToMenu" > 메뉴 정보 저장</button>>
    </div>
    <div>
        <button id="getToMenu" > 메뉴 정보 조회</button>
        <p>Data: <span id="data">N/A</span></p>
        <button id="getToMenuAll" > 메뉴 정보 전체 조회</button>
        <p>Data: <span id="dataAll">N/A</span></p>
    </div>
    <div>
        <button id="sendCoffeeUse1Setting">커피1 값세팅 - 45, 0, 110, 0</button>
        <button id="sendCoffeeUse2Setting">커피2 값세팅 - 0, 45, 110, 140</button>
        <button id="sendCoffeeUse">커피 추출</button>
        <button id="sendCoffeeUse1">커피 추출</button>
        <button id="sendTaeSetting">티 세팅</button>
        <button id="sendTeaUse">티 추출</button>
        <button id="sendSyrupSetting">시럽 세팅</button>
        <button id="sendSyrupUse">시럽 추출</button>
    </div>
    <br>
    <br>
    <div>
        <label for="setWaterTime">물 시간세팅</label>
        <input id="setWaterTime" type="text" placeholder=물시간입력 value="5" />
        <button id="sendWaterTime">물 세팅</button>
        <label for="setIceTime">얼음 시간세팅</label>
        <input id="setIceTime" type="text" placeholder=얼음시간입력 value="5" />
        <button id="sendIceTime">얼음 세팅</button>
        <button id="sendIceRun">카이저 - 출수</button>
        <button id="sendIceStop">카이저 - 정지</button>
        <button id="getIceInfo">카이저 - 정보</button>

    </div>
    <br>
    <br>
    <div>
        <button id="sendCupInfo">컵상태</button>
        <button id="sendCupPlUse">플라스틱</button>
        <button id="sendCupPaUse">종이</button>
    </div>
    <br>
    <br>
    <form name="form" method="post">
        <div>
            <label for="credit">신용카드</label>
            <input id="credit" type="radio" name="myRadios" onclick="handleClick(this);" value="credit" />
            <table class="w-full max-w-4xl border-2 border-gray-300 bg-white">
                <tbody>
                    <tr class="bg-blue-500 text-center">
                        <td colspan="3" class="text-white py-2">[요청 파라미터]</td>
                    </tr>
                    <tr class="text-left">
                        <td class="px-4 py-2"><label for="agreenum">승인번호 : </label> <input type="text"              id="agreenum"   name="agreenum"   class="w-24 h-6 border border-gray-300 p-1" value=""></td>
                        <td class="px-4 py-2"><label for="agreedate">승인날짜 : </label> <input type="text"             id="agreedate"   name="agreedate"   class="w-24 h-6 border border-gray-300 p-1" value="220502"></td>
                        <td class="px-4 py-2"><label for="catid">CATID   : </label> <input type="text"                id="catid"      name="catid"      class="w-24 h-6 border border-gray-300 p-1" value=""></td>
                    </tr>
                    <tr class="text-left">
                        <td class="px-4 py-2"><label for="halbu">할부 : </label><input type="text"              id="halbu"      name="halbu"    class="w-24 h-6 border border-gray-300 p-1" value="00"></td>
                        <td class="px-4 py-2"><label for="cashno">현금식별번호(바코드) : </label><input type="text" id="cashno"   name="cashno"   class="w-24 h-6 border border-gray-300 p-1" value="01023720000"></td>
                        <td class="px-4 py-2"><label for="money">총금액 : </label> <input type="text"            id="money"      name="money"     class="w-24 h-6 border border-gray-300 p-1" value="1004"></td>
                    </tr>
                    <tr class="text-left">
                        <td class="px-4 py-2"><label for="tax">부가세 : </label> <input type="text"            id="tax"        name="tax"     class="w-24 h-6 border border-gray-300 p-1" value="0"></td>
                        <td class="px-4 py-2"><label for="bongsa">봉사료  : </label> <input type="text"           id="bongsa"     name="bongsa"  class="w-24 h-6 border border-gray-300 p-1" value="0"></td>
                        <td class="px-4 py-2"><label for="myunse">면세금액 : </label> <input type="text"          id="myunse"     name="myunse"  class="w-24 h-6 border border-gray-300 p-1" value="0"></td>
                    </tr>
                </tbody>
            </table>
            <div>
                <br>
                <label for="SendData">SendData :</label> <input type="text" id="SendData" name="SendData" size="100"><br><br>
                <label for="RecvData">RecvData :</label>  :
                <textarea name="RecvData" id="RecvData" cols="100" rows="5"></textarea>
                <br><br>
                <a href="javascript:reqVCAT_HTTP()">VCAT 요청(HTTP방식)</a>

            </div>
        </div>
    </form>
</div>


<script>
    // 서버에서 version 값을 가져와서 화면에 표시
    fetch('http://localhost:3000/version')
        .then(response => response.json())
        .then(data => {
            document.getElementById('version').textContent = data.version;
        })
        .catch(error => console.error('Error fetching version:', error));


    // 얼음 옵션 선택에 따라 시간 입력 필드 노출
    const iceYes = document.getElementById('iceYes');
    const iceNo = document.getElementById('iceNo');
    const iceInput = document.getElementById('iceInput');

    // iceYes 선택 시, 입력 필드 노출
    iceYes.addEventListener('change', () => {
        if (iceYes.checked) {
            iceInput.style.display = 'block';
        }
    });

    // iceNo 선택 시, 입력 필드 숨김
    iceNo.addEventListener('change', () => {
        if (iceNo.checked) {
            iceInput.style.display = 'none';
        }
    });

    let itemCounter = 0; // 순번 카운터

    // 항목 추가 버튼
    document.getElementById('addItemBtn').addEventListener('click', () => {
        // 순번 증가
        itemCounter++;

        // itemContainer에 새로운 필드셋 추가
        const itemContainer = document.getElementById('itemContainer');
        const newFieldset = document.createElement('fieldset');
        newFieldset.id = `item${itemCounter}`;
        newFieldset.className = 'item-input';
        newFieldset.innerHTML = `
        <legend>항목 ${itemCounter}</legend>
        <label for="itemType${itemCounter}">타입</label>
        <select id="itemType${itemCounter}" name="itemType${itemCounter}">
            <option value="coffee">커피</option>
            <option value="garucha">가루차</option>
            <option value="syrup">시럽</option>
        </select>
        <label for="value1-${itemCounter}">값 1</label>
        <input type="number" id="value1-${itemCounter}" name="value1-${itemCounter}" min="0">
        <label for="value2-${itemCounter}">값 2</label>
        <input type="number" id="value2-${itemCounter}" name="value2-${itemCounter}" min="0">
        <label for="value3-${itemCounter}">값 3</label>
        <input type="number" id="value3-${itemCounter}" name="value3-${itemCounter}" min="0">
        <label for="value4-${itemCounter}">값 4</label>
        <input type="number" id="value4-${itemCounter}" name="value4-${itemCounter}" min="0">
        <button type="button" class="deleteItemBtn" data-id="${itemCounter}">삭제</button>
    `;
        itemContainer.appendChild(newFieldset);

        // 삭제 버튼 이벤트 추가
        const deleteBtn = newFieldset.querySelector('.deleteItemBtn');
        deleteBtn.addEventListener('click', () => deleteItem(itemCounter));
    });

    // 항목 삭제 함수
    const deleteItem = (id) => {
        const itemElement = document.getElementById(`item${id}`);
        if (itemElement) {
            itemElement.remove(); // 해당 필드셋 삭제
            console.log(`항목 ${id} 삭제됨`);
        }
    };

    // 저장 버튼 이벤트 리스너
    document.getElementById('saveMenuBtn').addEventListener('click', () => {
        const items = [];

        // 모든 item-input 필드셋에서 데이터 수집
        document.querySelectorAll('.item-input').forEach((fieldset) => {
            const itemId = fieldset.id.replace('item', ''); // 항목 ID 추출
            const itemType = document.getElementById(`itemType${itemId}`)?.value || 'None';
            const value1 = document.getElementById(`value1-${itemId}`)?.value || '0';
            const value2 = document.getElementById(`value2-${itemId}`)?.value || '0';
            const value3 = document.getElementById(`value3-${itemId}`)?.value || '0';
            const value4 = document.getElementById(`value4-${itemId}`)?.value || '0';

            items.push({
                type: itemType,
                no: parseInt(itemId, 10),
                value1,
                value2,
                value3,
                value4,
            });
        });

        // 각 옵션 값을 저장할 객체
        const selectedOptions = {
            name: document.getElementById('menuName')?.value || 'None',
            cup: document.querySelector('input[name="cup"]:checked')?.value || 'None',
            iceYn: document.querySelector('input[name="iceYn"]:checked')?.value || 'No',
            iceTime: document.querySelector('input[name="iceTime"]')?.value || '0',
            waterTime: document.querySelector('input[name="waterTime"]')?.value || '0',
            price: document.getElementById('price').value || 'None',
            image: 'https://placehold.co/200x300/png',
            category: document.getElementById('category').value || 'None',
            items, // 통합된 items 배열 추가
        };

        // 결과 출력
        document.getElementById('selectedOptions').innerHTML = `
        Name: ${selectedOptions.name}<br>
        Cup: ${selectedOptions.cup}<br>
        IceYn: ${selectedOptions.iceYn}<br>
        IceTime: ${selectedOptions.iceTime}<br>
        WaterTime: ${selectedOptions.waterTime}<br>
        Price: ${selectedOptions.price}<br>
        Image: ${selectedOptions.image}<br>
        Category: ${selectedOptions.category}<br>
        Items: ${JSON.stringify(selectedOptions.items, null, 2)}
    `;
    });

</script>
<script src="index.js"></script>
<script src="../../nvcat/Nvcat.js"> console.log('Nvcat.js 로드 완료'); </script>
<script>


</script>
</body>
</html>
